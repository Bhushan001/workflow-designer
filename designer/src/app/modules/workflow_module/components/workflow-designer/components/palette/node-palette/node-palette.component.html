@if (isCollapsed()) {
  <div class="palette-collapsed bg-white border-end d-flex flex-column align-items-center p-2">
    <button
      type="button"
      class="btn btn-sm btn-outline-secondary"
      (click)="toggleCollapse()"
      title="Expand Node Palette"
    >
      <fa-icon [icon]="faChevronRight"></fa-icon>
    </button>
  </div>
} @else {
  <div class="palette-expanded bg-white border-end d-flex flex-column">
    <div class="palette-header d-flex align-items-center justify-content-between">
      <h6 class="mb-0">Node Palette</h6>
      <button
        type="button"
        class="btn btn-sm btn-outline-secondary"
        (click)="toggleCollapse()"
        title="Collapse Node Palette"
      >
        <fa-icon [icon]="faChevronLeft"></fa-icon>
      </button>
    </div>

    <div class="flex-grow-1 overflow-auto">
      <div class="node-categories">
        @for (category of categories; track category.id) {
          <div class="node-category">
            <button
              type="button"
              class="category-header"
              (click)="toggleCategory(category.id)"
              [attr.aria-expanded]="category.expanded"
            >
              <div class="category-title">
                <fa-icon 
                  [icon]="category.icon" 
                  class="category-icon"
                  [style.color]="category.iconColor"
                ></fa-icon>
                <span class="category-name">{{ category.name }}</span>
                <span class="category-count">({{ category.nodes.length }})</span>
              </div>
              <fa-icon 
                [icon]="category.expanded ? faChevronUp : faChevronDown"
                class="category-chevron"
              ></fa-icon>
            </button>
            
            @if (category.expanded) {
              <div class="category-content">
                @for (node of category.nodes; track node.type) {
                  <button
                    type="button"
                    class="node-palette-item"
                    (click)="onAddNode(node.type)"
                    [title]="node.description || node.label"
                  >
                    <fa-icon [icon]="node.icon" [class]="node.colorClass"></fa-icon>
                    <div class="node-info">
                      <span class="node-label">{{ node.label }}</span>
                      @if (node.description) {
                        <span class="node-description">{{ node.description }}</span>
                      }
                    </div>
                  </button>
                }
              </div>
            }
          </div>
        }
      </div>

      <div class="palette-info">
        <p class="small mb-0">
          <fa-icon [icon]="faBolt" class="me-1"></fa-icon>
          Click a node to add it to the canvas
        </p>
      </div>
    </div>
  </div>
}
